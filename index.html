<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <title>Interaction Authoring Gallery</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/codemirror.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/codemirror.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/mode/javascript/javascript.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/mode/json/json.min.js"></script>

    <!-- <link rel="stylesheet" href="css/dsl_renderer_style.css"> -->
    <link rel="stylesheet" href="css/gallery.css">
</head>

<body>
    <nav class="navbar">
        <h1>Interaction Authoring Gallery</h1>
        <button id="dark-mode-toggle">Theme</button>
    </nav>


    <div class="gallery-container" id="gallery">
        <!-- Gallery items will be dynamically inserted here -->
    </div>
    <script>

        const darkModeToggle = document.getElementById("dark-mode-toggle");

        // è¯»å–æœ¬åœ°å­˜å‚¨å¹¶è®¾ç½®æ¨¡å¼
        if (localStorage.getItem("dark-mode") === "enabled") {
            document.body.classList.add("dark-mode");
        }

        // ç›‘å¬ç‚¹å‡»äº‹ä»¶åˆ‡æ¢æ¨¡å¼
        darkModeToggle.addEventListener("click", () => {
            document.body.classList.toggle("dark-mode");

            if (document.body.classList.contains("dark-mode")) {
                localStorage.setItem("dark-mode", "enabled");
            } else {
                localStorage.removeItem("dark-mode");
            }
        });

        document.addEventListener("DOMContentLoaded", function () {
            const files = new Set();

            async function fetchData() {
                try {
                    // ğŸ”¹ shared/shared_list.txt íŒŒì¼ ì§ì ‘ ì½ê¸°
                    const response = await fetch("./shared/shared_list.txt");
                    if (!response.ok) {
                        throw new Error("shared_list.txt íŒŒì¼ ë¡œë“œ ì‹¤íŒ¨");
                    }

                    const text = await response.text();
                    const lines = text
                        .split("\n")
                        .map(line => line.trim())
                        .filter(line => line.length > 0); // ë¹ˆ ì¤„ ì œê±°

                    const chartData = { files: lines }; // ğŸ”¹ server.pyê°€ ì£¼ë˜ êµ¬ì¡° ëª¨ë°©

                    if (chartData.files && Array.isArray(chartData.files)) {
                        chartData.files.forEach(file => files.add(file));
                    } else {
                        console.error("íŒŒì¼ ëª©ë¡ì„ ì²˜ë¦¬í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
                    }

                    // ğŸ”¹ renderGallery í˜¸ì¶œ
                    renderGallery([...files]);
                } catch (error) {
                    console.error("íŒŒì¼ ì½ê¸° ì˜¤ë¥˜:", error);
                    renderGallery(Array.from(files)); // ì‹¤íŒ¨ ì‹œë¼ë„ ë¹ˆ ë°°ì—´ ë Œë”ë§
                }
            }


            function renderGallery(fileList) {
                const gallery = document.getElementById("gallery");
                gallery.innerHTML = ""; // ê¸°ì¡´ ê°¤ëŸ¬ë¦¬ ì´ˆê¸°í™” (ì¤‘ë³µ ë°©ì§€)

                fileList.forEach(file => {
                    const item = document.createElement("div");
                    item.className = "gallery-item";

                    const fileNameWithoutExt = file.replace(".json", "");
                    const previewId = `preview-${fileNameWithoutExt}`;
                    const imagePath = `./shared/image/${fileNameWithoutExt}.svg`;

                    const previewDiv = document.createElement("div");
                    previewDiv.className = "preview";
                    previewDiv.id = previewId;

                    // SVG ê°€ì ¸ì˜¤ê¸°
                    fetch(imagePath)
                        .then(response => {
                            if (!response.ok) {
                                throw new Error(`SVG ë¡œë“œ ì‹¤íŒ¨: ${response.status}`);
                            }
                            return response.text();
                        })
                        .then(svgContent => {
                            previewDiv.innerHTML = svgContent;
                        })
                        .catch(error => {
                            console.error(error);
                        });

                    // ì•„ì´í…œ ì •ë³´ ì¶”ê°€
                    const infoDiv = document.createElement("div");
                    infoDiv.className = "item-info";
                    infoDiv.innerHTML = `
                        <h2 class="item-title">${formatFileName(file)}</h2>
                        <a href="./show.html?${fileNameWithoutExt}" class="view-button">View Chart</a>
                    `;

                    item.appendChild(previewDiv);
                    item.appendChild(infoDiv);
                    gallery.appendChild(item);
                });
            }


            function formatFileName(fileName) {
                return fileName
                    .replace(/\.(json|svg)$/, "")
                    .replace(/_/g, " ")
                    .split(" ")
                    .map(word => word.charAt(0).toUpperCase() + word.slice(1).toLowerCase())
                    .join(" ");
            }

            fetchData(); // ğŸš€ fetchData ì‹¤í–‰ (ìµœì´ˆ í•œ ë²ˆë§Œ ì‹¤í–‰ë¨)
        });
    </script>
</body>

</html>